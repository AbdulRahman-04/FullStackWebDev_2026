========================================
PostgreSQL Complete Notes (Beginner)
========================================

----------------------------------------
1) What is Database (DB)?
----------------------------------------
Database = data store karne ki jagah.

Example:
Users ka data, products ka data, orders ka data
-> sab database me store hota hai.

Instead of:
text files / excel
We use:
Database (fast, safe, structured)

----------------------------------------
2) What is DBMS?
----------------------------------------
DBMS = Database Management System

It is software to:
- store data
- update data
- delete data
- secure data

Examples:
MySQL, PostgreSQL, Oracle, SQL Server

----------------------------------------
3) What is RDBMS?
----------------------------------------
RDBMS = Relational Database Management System

Data is stored in:
Tables (rows + columns)

Relations:
One table can be related to another table.

Example:
users table
orders table
orders.user_id -> users.id

Examples:
PostgreSQL, MySQL, Oracle

----------------------------------------
4) What is PostgreSQL?
----------------------------------------
PostgreSQL = open-source RDBMS

Features:
- free
- very powerful
- ACID compliant
- used in real companies

----------------------------------------
5) Advantages of PostgreSQL
----------------------------------------
- Open source (free)
- Very reliable
- Supports JSON + SQL
- Strong constraints
- Good for large apps
- Used with backend (Node, Go, Java, etc.)

----------------------------------------
6) Install PostgreSQL (WSL - Ubuntu)
----------------------------------------

sudo apt update
sudo apt install postgresql postgresql-contrib

Start service:
sudo service postgresql start

Login:
sudo -u postgres psql

Create database:
CREATE DATABASE testdb;
\c testdb

----------------------------------------
7) pgAdmin (GUI Tool)
----------------------------------------
pgAdmin = graphical tool to run SQL queries

Steps:
- Open pgAdmin
- Register Server
- Host: localhost
- Port: 5432
- Username: postgres
- Password: your password
- Select DB and Select query tool to go to query tool of that specific db

========================================
PostgreSQL Notes (Simple English Order)
========================================

----------------------------------------
1) Create Database
----------------------------------------

CREATE DATABASE mydb;
\c mydb;

----------------------------------------
2) Create Table
----------------------------------------

CREATE TABLE employees(
  id SERIAL PRIMARY KEY,
  name VARCHAR(50) NOT NULL,
  email VARCHAR(100) UNIQUE,
  salary DECIMAL(10,2),
  dept VARCHAR(50),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

----------------------------------------
3) Insert Data
----------------------------------------

INSERT INTO employees (name, email, salary, dept) VALUES
('Ali','ali@gmail.com',40000,'IT'),
('Zain','zain@gmail.com',45000,'HR'),
('Umar','umar@gmail.com',50000,'Finance');

----------------------------------------
4) Select Data
----------------------------------------

SELECT * FROM employees;
SELECT name, salary FROM employees;

----------------------------------------
5) Update Data
----------------------------------------

UPDATE employees
SET salary = 55000
WHERE name = 'Ali';

----------------------------------------
6) Delete Data
----------------------------------------

DELETE FROM employees WHERE name = 'Zain';

----------------------------------------
7) Constraints
----------------------------------------

PRIMARY KEY  
UNIQUE  
NOT NULL  
DEFAULT  
FOREIGN KEY  

Example:

ALTER TABLE employees
ALTER COLUMN email SET NOT NULL;

----------------------------------------
8) WHERE Clause (filter rows)
----------------------------------------

SELECT * FROM employees WHERE dept = 'IT';
SELECT * FROM employees WHERE salary > 45000;

----------------------------------------
9) IN / NOT IN / BETWEEN
----------------------------------------

SELECT * FROM employees WHERE dept IN ('IT','HR');
SELECT * FROM employees WHERE dept NOT IN ('Sales');
SELECT * FROM employees WHERE salary BETWEEN 40000 AND 50000;

----------------------------------------
10) DISTINCT
----------------------------------------

SELECT DISTINCT dept FROM employees;

----------------------------------------
11) ORDER BY
----------------------------------------

SELECT * FROM employees ORDER BY salary ASC;
SELECT * FROM employees ORDER BY salary DESC;

----------------------------------------
12) LIMIT & OFFSET
----------------------------------------

SELECT * FROM employees ORDER BY salary DESC LIMIT 2;
SELECT * FROM employees ORDER BY salary DESC LIMIT 2 OFFSET 2;

----------------------------------------
13) LIKE
----------------------------------------

SELECT * FROM employees WHERE name LIKE 'A%';
SELECT * FROM employees WHERE email LIKE '%gmail%';

----------------------------------------
14) Aggregate Functions
----------------------------------------

COUNT, SUM, AVG, MIN, MAX

SELECT COUNT(*) FROM employees;
SELECT SUM(salary) FROM employees;
SELECT AVG(salary) FROM employees;
SELECT MAX(salary) FROM employees;
SELECT MIN(salary) FROM employees;

----------------------------------------
15) GROUP BY
----------------------------------------

SELECT dept, COUNT(*) 
FROM employees
GROUP BY dept;

SELECT dept, SUM(salary)
FROM employees
GROUP BY dept;

----------------------------------------
16) ALTER TABLE
----------------------------------------

ALTER TABLE employees ADD COLUMN age INT;
ALTER TABLE employees DROP COLUMN age;
ALTER TABLE employees RENAME COLUMN dept TO department;

----------------------------------------
17) HAVING (filter groups)
----------------------------------------

SELECT dept, AVG(salary)
FROM employees
GROUP BY dept
HAVING AVG(salary) > 45000;

----------------------------------------
18) Relationships (Foreign Key)
----------------------------------------

One-to-Many Example:
One department → many employees

CREATE TABLE dept(
  dept_id SERIAL PRIMARY KEY,
  dept_name VARCHAR(50)
);

CREATE TABLE employees(
  id SERIAL PRIMARY KEY,
  name VARCHAR(50),
  dept_id INT REFERENCES dept(dept_id)
);

----------------------------------------
19) Many-to-Many Relationship
----------------------------------------

students ↔ courses

CREATE TABLE students(
  id SERIAL PRIMARY KEY,
  name VARCHAR(50)
);

CREATE TABLE courses(
  id SERIAL PRIMARY KEY,
  title VARCHAR(50)
);

CREATE TABLE student_courses(
  student_id INT REFERENCES students(id),
  course_id INT REFERENCES courses(id),
  PRIMARY KEY(student_id, course_id)
);

----------------------------------------
20) JOINS (Last Topic)
----------------------------------------

CROSS JOIN:
All combinations

SELECT * FROM employees CROSS JOIN dept;

INNER JOIN:
Only matching rows

SELECT employees.name, dept.dept_name
FROM employees
INNER JOIN dept
ON employees.dept_id = dept.dept_id;

LEFT JOIN:
All left table rows

SELECT employees.name, dept.dept_name
FROM employees
LEFT JOIN dept
ON employees.dept_id = dept.dept_id;

RIGHT JOIN:
All right table rows

SELECT employees.name, dept.dept_name
FROM employees
RIGHT JOIN dept
ON employees.dept_id = dept.dept_id;


INDEXING N POSTGRESQL: 
-- Index create
CREATE INDEX idx_users_email ON users(email);

-- Check index use hua ya nahi
EXPLAIN ANALYZE
SELECT * FROM users WHERE email = 'a@gmail.com';

-- Index Scan = index use
-- Seq Scan   = full table scan

-- Drop index
DROP INDEX idx_users_email;



TRANSACTIONS IN SQL/POSTGRESQL:
-- COMMIT example (save)
BEGIN;

INSERT INTO orders(order_no, customer, status, amount)
VALUES ('ORD1', 'Ali', 'pending', 1000);

COMMIT;


-- ROLLBACK example (undo)
BEGIN;

INSERT INTO orders(order_no, customer, status, amount)
VALUES ('ORD2', 'Rahman', 'pending', 2000);

ROLLBACK;


-- Auto rollback on error
BEGIN;

INSERT INTO orders(order_no, customer, status, amount)
VALUES ('ORD3', 'X', 'pending', 3000);

UPDATE orders SET wrongcol = 5 WHERE order_no = 'ORD3'; -- error

COMMIT;

-- Check (should return 0 rows)
SELECT * FROM orders WHERE order_no = 'ORD3';

-- After error always do:
ROLLBACK;


/* =========================
   ON DELETE (FOREIGN KEY)
   =========================

ON DELETE = jab parent table ka row delete hota hai,
toh child table ke rows ke saath kya hoga, ye decide karta hai.

Parent = users
Child  = posts
*/


/* =========================
   1) ON DELETE CASCADE
   =========================
Definition:
Parent delete → child rows bhi delete
*/

CREATE TABLE users (
  id SERIAL PRIMARY KEY,
  name TEXT
);

CREATE TABLE posts_cascade (
  id SERIAL PRIMARY KEY,
  user_id INT REFERENCES users(id) ON DELETE CASCADE,
  title TEXT
);

INSERT INTO users(name) VALUES ('Ali');
INSERT INTO posts_cascade(user_id, title) VALUES (1, 'Ali post');

DELETE FROM users WHERE id = 1;

SELECT * FROM posts_cascade;  -- result: empty



/* =========================
   2) ON DELETE SET NULL
   =========================
Definition:
Parent delete → child row rahegi, bas FK NULL ho jaayega
*/

CREATE TABLE posts_setnull (
  id SERIAL PRIMARY KEY,
  user_id INT REFERENCES users(id) ON DELETE SET NULL,
  title TEXT
);

INSERT INTO users(name) VALUES ('Rahman');
INSERT INTO posts_setnull(user_id, title) VALUES (2, 'Rahman post');

DELETE FROM users WHERE id = 2;

SELECT * FROM posts_setnull;  
-- result: user_id = NULL



/* =========================
   3) ON DELETE RESTRICT (default)
   =========================
Definition:
Parent delete allowed nahi jab tak child rows exist karti ho
*/

CREATE TABLE posts_restrict (
  id SERIAL PRIMARY KEY,
  user_id INT REFERENCES users(id) ON DELETE RESTRICT,
  title TEXT
);

INSERT INTO users(name) VALUES ('Zaid');
INSERT INTO posts_restrict(user_id, title) VALUES (3, 'Zaid post');

DELETE FROM users WHERE id = 3;  
-- ERROR: violates foreign key constraint



/* =========================
   4) ON DELETE NO ACTION
   =========================
Definition:
RESTRICT jaisa hi behave karta hai (delete block)
*/

CREATE TABLE posts_noaction (
  id SERIAL PRIMARY KEY,
  user_id INT REFERENCES users(id) ON DELETE NO ACTION,
  title TEXT
);

INSERT INTO users(name) VALUES ('Umar');
INSERT INTO posts_noaction(user_id, title) VALUES (4, 'Umar post');

DELETE FROM users WHERE id = 4;  
-- ERROR



/* =========================
   SUMMARY
   =========================

CASCADE   → child delete
SET NULL  → child rahe, FK NULL
RESTRICT  → delete block
NO ACTION → delete block
*/



========================================
END OF NOTES
========================================
